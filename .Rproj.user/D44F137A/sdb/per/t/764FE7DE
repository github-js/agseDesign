{
    "collab_server" : "",
    "contents" : "#' @importFrom msm ptnorm\n\n######################################################################\n# Probability of being above/below the futility boundary in stage I\n#\n######################################################################\nlibrary(msm) # needed for truncated normal\n\n######################################\n# Function 1\n# Stage 1 Subgroup 1 Outcome 1 Greater\n######################################\n\nStage1.S1.O1.Gt<-function(a,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[1,1]),th1[1]*D1[1,1],sqrt(D1[1,1]),lower.tail=F)\n\n}\n\n\n\n####################################\n# Function 2\n# Stage 1 Subgroup 1 Outcome 1 Less\n####################################\n\nStage1.S1.O1.Lt<-function(a,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[1,1]),th1[1]*D1[1,1],sqrt(D1[1,1]),lower.tail=T)\n\n}\n\n\n######################################\n# Function 3\n# Stage 1 Subgroup 1 Outcome 2 Greater\n######################################\n\nStage1.S1.O2.Gt<-function(a,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[1,2]),th1[2]*D1[1,2],sqrt(D1[1,2]),lower.tail=F)\n\n}\n\n\n###################################\n# Function 4\n# Stage 1 Subgroup 1 Outcome 2 Less\n###################################\n\nStage1.S1.O2.Lt<-function(a,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[1,2]),th1[2]*D1[1,2],sqrt(D1[1,2]),lower.tail=T)\n\n}\n\n\n######################################\n# Function 5\n# Stage 1 Subgroup 2 Outcome 1 Greater\n######################################\n\nStage1.S2.O1.Gt<-function(a,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[2,1]),th2[1]*D1[2,1],sqrt(D1[2,1]),lower.tail=F)\n\n}\n\n\n####################################\n# Function 6\n# Stage 1 Subgroup 2 Outcome 1 Less\n####################################\n\nStage1.S2.O1.Lt<-function(a,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[2,1]),th2[1]*D1[2,1],sqrt(D1[2,1]),lower.tail=T)\n\n}\n\n\n######################################\n# Function 7\n# Stage 1 Subgroup 2 Outcome 2 Greater\n######################################\n\nStage1.S2.O2.Gt<-function(a,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[2,2]),th2[2]*D1[2,2],sqrt(D1[2,2]),lower.tail=F)\n\n}\n\n\n#####################################\n# Function 8\n# Stage 1 Subgroup 2 Outcome 2 Less\n#####################################\n\nStage1.S2.O2.Lt<-function(a,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  pnorm(a*sqrt(D1[2,2]),th2[2]*D1[2,2],sqrt(D1[2,2]),lower.tail=T)\n\n}\n\n\n#################################################################################\n# Computation of 16 path probabilities (E0-E15) for decision rule\n#\n################################################################################\n\n\n##########################################################\n# Function 9. Computation of probability E-0\n#\n##########################################################\n\nProb.E0<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n##########################################################\n# Function 10. Computation of probability E-1\n#\n##########################################################\n\nProb.E1<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n\n\n\n##########################################################\n# Function 11. Computation of probability E-2\n#\n##########################################################\n\nProb.E2<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n\n##########################################################\n# Function 12. Computation of probability E-3\n#\n##########################################################\n\n\nProb.E3<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n\n\n##########################################################\n# Function 13. Computation of probability E-4\n#\n##########################################################\n\n\nProb.E4<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n\n##########################################################\n# Function 14. Computation of probability E-5\n#\n##########################################################\n\n\nProb.E5<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n\n\n##########################################################\n# Function 15. Computation of probability E-6\n#\n##########################################################\n\n\nProb.E6<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n##########################################################\n# Function 16. Computation of probability E-7\n#\n##########################################################\n\n\nProb.E7<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n##########################################################\n# Function 17. Computation of probability E-8\n#\n##########################################################\n\n\nProb.E8<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n##########################################################\n# Function 18. Computation of probability E-9\n#\n##########################################################\n\n\nProb.E9<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n\n\n##########################################################\n# Function 19. Computation of probability E-10\n#\n##########################################################\n\n\nProb.E10<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n\n##########################################################\n# Function 20. Computation of probability E-11\n#\n##########################################################\n\nProb.E11<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Lt(a,th2,D)\n\n\n}\n\n\n\n##########################################################\n# Function 21. Computation of probability E-12\n#\n##########################################################\n\nProb.E12<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Lt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n\n##########################################################\n# Function 22. Computation of probability E-13\n#\n##########################################################\n\nProb.E13<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Lt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n##########################################################\n# Function 23. Computation of probability E-14\n#\n##########################################################\n\nProb.E14<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Lt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n##########################################################\n# Function 24. Computation of probability E-15\n# Both Subgroup selected\n##########################################################\n\nProb.E15<-function(a,th1,th2,D){\n\n  Stage1.S1.O1.Gt(a,th1,D)*Stage1.S1.O2.Gt(a,th1,D)*Stage1.S2.O1.Gt(a,th2,D)*Stage1.S2.O2.Gt(a,th2,D)\n\n\n}\n\n\n\n\n\n######################################################################\n# Probability of being above/below the efficacy boundary in stage I\n#\n######################################################################\n\n\n\n\n\n##########################################################\n# Function 25\n# Stage 1 Subgroup 1 Outcome 1 Greater than upper boundary\n##########################################################\n\nStage1.S1.O1.Tn.Gt<-function(a,b,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[1,1]),th1[1]*D1[1,1],sqrt(D1[1,1]),lower=a*sqrt(D1[1,1]),lower.tail=F)\n\n}\n\n\n\n##########################################################\n# Function 26\n# Stage 1 Subgroup 1 Outcome 1 less than upper boundary\n##########################################################\n\nStage1.S1.O1.Tn.Lt<-function(a,b,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[1,1]),th1[1]*D1[1,1],sqrt(D1[1,1]),lower=a*sqrt(D1[1,1]),lower.tail=T)\n\n}\n\n\n\n##########################################################\n# Function 27\n# Stage 1 Subgroup 1 Outcome 2 Greater than upper boundary\n##########################################################\n\n\nStage1.S1.O2.Tn.Gt<-function(a,b,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[1,2]),th1[2]*D1[1,2],sqrt(D1[1,2]),lower=a*sqrt(D1[1,2]),lower.tail=F)\n\n}\n\n\n##########################################################\n# Function 28\n# Stage 1 Subgroup 1 Outcome 2 Less than upper boundary\n##########################################################\n\n\nStage1.S1.O2.Tn.Lt<-function(a,b,th1,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[1,2]),th1[2]*D1[1,2],sqrt(D1[1,2]),lower=a*sqrt(D1[1,2]),lower.tail=T)\n\n}\n\n\n\n\n##########################################################\n# Function 29\n# Stage 1 Subgroup 2 Outcome 1 Greater than upper boundary\n##########################################################\n\n\nStage1.S2.O1.Tn.Gt<-function(a,b,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[2,1]),th2[1]*D1[2,1],sqrt(D1[2,1]),lower=a*sqrt(D1[2,1]),lower.tail=F)\n\n}\n\n\n\n##########################################################\n# Function 30\n# Stage 1 Subgroup 2 Outcome 1 Less than upper boundary\n##########################################################\n\n\nStage1.S2.O1.Tn.Lt<-function(a,b,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[2,1]),th2[1]*D1[2,1],sqrt(D1[2,1]),lower=a*sqrt(D1[2,1]),lower.tail=T)\n\n}\n\n\n##########################################################\n# Function 31\n# Stage 1 Subgroup 2 Outcome 2 Greater than upper boundary\n##########################################################\n\n\nStage1.S2.O2.Tn.Gt<-function(a,b,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[2,2]),th2[2]*D1[2,2],sqrt(D1[2,2]),lower=a*sqrt(D1[2,2]),lower.tail=F)\n\n}\n\n\n\n\n##########################################################\n# Function 32\n# Stage 1 Subgroup 2 Outcome 2 Less than upper boundary\n##########################################################\n\n\nStage1.S2.O2.Tn.Lt<-function(a,b,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  ptnorm(b*sqrt(D1[2,2]),th2[2]*D1[2,2],sqrt(D1[2,2]),lower=a*sqrt(D1[2,2]),lower.tail=T)\n\n}\n\n\n## Both crossing/not crossing the upper boundary\n#\n# #########################################################\n# # Function 33\n# # When both subgroups are selected we pull them together\n# # Below is the distribution of the sum of two truncated normal variables\n# # This is done for outcome outcome 1\n# #########################################################\n#\n# Stage1.S12.O1.Tn.Dt <- function(y,a,th1,th2,D) {\n#\n#   D1=matrix(D,nrow=2,ncol=2,byrow=T)\n#\n#   mu11=th1[1]*D1[1,1]\n#   sig11=sqrt(D1[1,1])\n#   mu21=th2[1]*D1[2,1]\n#   sig21=sqrt(D1[2,1])\n#   Stage1.S1.O1.Select.lower=a*sqrt(D1[1,1])\n#   Stage1.S2.O1.Select.lower=a*sqrt(D1[2,1])\n#\n#\n#   integrand <- function(x) {\n#\n#     f1 <- dtnorm(x,mu11,sig11,lower=Stage1.S1.O1.Select.lower)\n#     f2 <- dtnorm(y-x,mu21,sig21,lower=Stage1.S2.O1.Select.lower)\n#     return(f1*f2)\n#   }\n#   int <- integrate(integrand,lower=Stage1.S1.O1.Select.lower,upper=y-Stage1.S2.O1.Select.lower)\n#\n#   return(int$value)\n# }\n\n\n\n\n#####################################################\n# Function 33\n# Outcome 1 for both subgroup is above upper bounday\n####################################################\n\n\nStage1.S12.O1.Tn.Gt<-function(a,b,th1,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  mu11=th1[1]*D1[1,1]\n  sig11=sqrt(D1[1,1])\n  mu21=th2[1]*D1[2,1]\n  sig21=sqrt(D1[2,1])\n  Stage1.S1.O1.Select.lower=a*sqrt(D1[1,1])        # Subgroup 1, Outcome 1 lower bound for selection\n  Stage1.S2.O1.Select.lower=a*sqrt(D1[2,1])        # Subgroup 2, Outcome 1 lower bound for selection\n\n  Stage1.S12.O1.upper=b*sqrt(D1[1,1]+D1[2,1])      # Subgroup 1 & 2, Outcome 1 upper bound for rejection/acceptace\n\n\n\n  Stage1.S12.O1.Tn.Dt <- function(y)\n  {\n\n    integrand <- function(x)\n    {\n\n      f1 <- dtnorm(x,mu11,sig11,lower=Stage1.S1.O1.Select.lower)\n      f2 <- dtnorm(y-x,mu21,sig21,lower=Stage1.S2.O1.Select.lower)\n      return(f1*f2)\n    }\n\n    int.x <- integrate(integrand,lower=Stage1.S1.O1.Select.lower,upper=y-Stage1.S2.O1.Select.lower)\n\n    return(int.x$value)\n  }\n\n\n  int.y<-integrate(Vectorize(Stage1.S12.O1.Tn.Dt),lower=Stage1.S12.O1.upper,upper=Inf)\n\n\n  return(int.y$value)\n}\n\n\n\n\n#####################################################\n# Function 34\n# Outcome 1 for both subgroup is less than upper bounday\n####################################################\n\n\n\n\n\n\n\n#####################################################\n# Function 35\n# Outcome 2 for both subgroup is above upper bounday\n####################################################\n\n\nStage1.S12.O2.Tn.Gt<-function(a,b,th1,th2,D){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n\n  mu12=th1[2]*D1[1,2]\n  sig12=sqrt(D1[1,2])\n\n\n  mu22=th2[2]*D1[2,2]\n  sig22=sqrt(D1[2,2])\n\n\n  Stage1.S1.O2.Select.lower=a*sqrt(D1[1,2])        # Subgroup 1, Outcome 2 lower bound for selection\n  Stage1.S2.O2.Select.lower=a*sqrt(D1[2,2])        # Subgroup 2, Outcome 2 lower bound for selection\n\n  Stage1.S12.O2.upper=b*sqrt(D1[1,2]+D1[2,2])      # Subgroup 1 & 2, Outcome 2 upper bound for rejection/acceptace\n\n\n\n  Stage1.S12.O2.Tn.Dt <- function(y)\n  {\n\n    integrand <- function(x)\n    {\n\n      f1 <- dtnorm(x,mu12,sig12,lower=Stage1.S1.O2.Select.lower)\n      f2 <- dtnorm(y-x,mu22,sig22,lower=Stage1.S2.O2.Select.lower)\n      return(f1*f2)\n    }\n\n    int.x <- integrate(integrand,lower=Stage1.S1.O2.Select.lower,upper=y-Stage1.S2.O2.Select.lower)\n\n    return(int.x$value)\n  }\n\n\n  int.y<-integrate(Vectorize(Stage1.S12.O2.Tn.Dt),lower=Stage1.S12.O2.upper,upper=Inf)\n\n\n  return(int.y$value)\n}\n\n\n\n\n#####################################################\n# Function 36\n# Outcome 2 for both subgroup is below upper bounday\n####################################################\n\n\n\n\n\n\n##########################################################\n# Function 37. Subgroup 2, Outcome 1 & Outcome 2 greater than upper boundary\n# Subgroup 2 selected\n##########################################################\n\n\nStage1.S2.Reject.Given.S2.Select<-function(a,b,th2,D)\n\n{\n  Stage1.S2.O1.Tn.Gt(a=a,b=b,th2=th2,D=D)*Stage1.S2.O2.Tn.Gt(a=a,b=b,th2=th2,D=D)\n\n}\n\n\n\n##########################################################\n# Function 38. Subgroup 1, Outcome 1 & Outcome 2 greater than upper boundary\n# Subgroup 1 select\n##########################################################\n\n\nStage1.S1.Reject.Given.S1.Select<-function(a,b,th1,D)\n\n{\n  Stage1.S1.O1.Tn.Gt(a=a,b=b,th1=th1,D=D)*Stage1.S1.O2.Tn.Gt(a=a,b=b,th1=th1,D=D)\n\n}\n\n\n##########################################################\n# Function 39. Subgroup 1 & 2, Outcome 1 & Outcome 2 greater than upper boundary\n# Both Subgroups are selected\n##########################################################\n\n\nStage1.S12.Reject.Given.S12.Select<-function(a,b,th1,th2,D)\n\n{\n  Stage1.S12.O1.Tn.Gt(a=a,b=b,th1=th1,th2=th2,D=D)*Stage1.S12.O2.Tn.Gt(a=a,b=b,th1=th1,th2=th2,D=D)\n\n}\n\n\n\n##########################################################\n# Function 40. Only Subgroup 2 Selected\n#\n##########################################################\n\nStage1.S2.Select<-function(a,b,th1,th2,D)\n{\n  (Prob.E3(a=a,th1=th1,th2=th2,D=D)+Prob.E13(a=a,th1=th1,th2=th2,D=D)+Prob.E14(a=a,th1=th1,th2=th2,D=D))\n}\n\n\n\n##########################################################\n# Function 40. Only Subgroup 2 Selected\n#\n##########################################################\n\nStage1.S1.Select<-function(a,b,th1,th2,D)\n{\n  (Prob.E6(a=a,th1=th1,th2=th2,D=D)+Prob.E11(a=a,th1=th1,th2=th2,D=D)+Prob.E12(a=a,th1=th1,th2=th2,D=D))\n}\n\n\n\n##########################################################\n# Function 40. Only Subgroup 2 Selected\n#\n##########################################################\n\nStage1.S12.Select<-function(a,b,th1,th2,D)\n{\n  (Prob.E15(a=a,th1=th1,th2=th2,D=D))\n}\n\n\n##########################################################\n# Function 40. Only efficacious in Subgroup 2\n#\n##########################################################\n\n\nStage1.S2.Ef<-function(a,b,th1,th2,D)\n\n{\n\n  Stage1.S2.Select(a=a,b=b,th1=th1,th2=th2,D=D)*Stage1.S2.Reject.Given.S2.Select(a=a,b=b,th2=th2,D=D)\n\n}\n\n\n\n##########################################################\n# Function 41. Only efficacious in Subgroup 1\n#\n##########################################################\n\n\nStage1.S1.Ef<-function(a,b,th1,th2,D)\n\n{\n\n  Stage1.S1.Select(a=a,b=b,th1=th1,th2=th2,D=D)*Stage1.S1.Reject.Given.S1.Select(a=a,b=b,th1=th1,D=D)\n\n}\n\n\n##########################################################\n# Function 42. Efficacacious in Subgroup 1 & Subgroup2\n#\n##########################################################\n\n\nStage1.S12.Ef<-function(a,b,th1,th2,D)\n\n{\n\n  Stage1.S12.Select(a=a,th1=th1,th2=th2,D=D)*Stage1.S12.Reject.Given.S12.Select(a=a,b=b,th1=th1,th2=th2,D=D)\n\n}\n\n\n\n##########################################################\n# Function 43. Stage I total Acceptance probability for futility\n#\n##########################################################\n\n\nStage1.Total.Ft<-function(a,b,th1,th2,D)\n\n{\n\n  Prob.E0(a=a,th1=th1,th2=th2,D=D)+Prob.E1(a=a,th1=th1,th2=th2,D=D)+Prob.E2(a=a,th1=th1,th2=th2,D=D)+\n    Prob.E4(a=a,th1=th1,th2=th2,D=D)+Prob.E5(a=a,th1=th1,th2=th2,D=D)+Prob.E7(a=a,th1=th1,th2=th2,D=D)+\n    Prob.E8(a=a,th1=th1,th2=th2,D=D)+Prob.E9(a=a,th1=th1,th2=th2,D=D)+Prob.E10(a=a,th1=th1,th2=th2,D=D)\n\n\n}\n\n\n\n\n##########################################################\n# Function 44. Stage I total rejection probability for efficacy\n#\n##########################################################\n\n\nStage1.Total.Ef<-function(a,b,th1,th2,D)\n\n{\n  Stage1.S1.Ef(a=a,b=b,th1=th1,th2=th2,D=D)+Stage1.S2.Ef(a=a,b=b,th1=th1,th2=th2,D=D)+Stage1.S12.Ef(a=a,b=b,th1=th1,th2=th2,D=D)\n}\n\n\n\n\n\n##########################################################\n# Function 45. Computation of boundary values in Stage I\n#\n##########################################################\n\n\nStage1.Boundary.Values<-function(lims1,D,th1,th2,au,al,optimize=T){\n\n  a=lims1[1]\n  b=lims1[2]\n\n  if (optimize==T) {\n\n    retval<-(Stage1.Total.Ef(a=a,b=b,th1=th1,th2=th2,D=D)-au)^2+(Stage1.Total.Ft(a=a,b=b,th1=th1,th2=th2,D=D)-al)^2\n\n  } else{\n\n    retval<-list(TR=Stage1.Total.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 OR=Stage1.S12.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 S1=Stage1.S1.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 S2=Stage1.S2.Ef(a=a,b=b,th1=th1,th2=th2,D=D))\n\n  }\n  return(retval)\n\n}\n\n\n\n\n\n\n##########################################################\n# Function 46. Computation of Optimum information in Stage I\n#\n##########################################################\n\n\nStage1.Inf.Optimization<-function(D,a,b,th1,th2,optimize=T)\n\n{\n\n  if (optimize==T) {\n\n    retval<-(Stage1.Total.Ef(a=a,b=b,th1=th1,th2=th2,D=D)-0.405)^2\n\n\n  } else{\n\n    retval<-list(TR=Stage1.Total.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 OR=Stage1.S12.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 S1=Stage1.S1.Ef(a=a,b=b,th1=th1,th2=th2,D=D),\n                 S2=Stage1.S2.Ef(a=a,b=b,th1=th1,th2=th2,D=D))\n\n  }\n\n  return(retval)\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n##########################################################\n# Function 47. Stage 2 subgroup 1 outcome 1 distribution\n#lt=F will generate the proability that the outcome 1 in stage 2 is above efficacy boundary\n#lt=T will generate the proability that the outcome 1 in stage 2 is below efficacy boundary\n# l.lim and u.lim will regulate if the ourcome 1 at stage 1 was above/below efficacy boundary\n##########################################################\n\n\nStage2.S1.O1.Dt<-function(a,b,c1,th1,th2,D,Ds2,l.lim,u.lim,lt)\n\n{\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S1.O1.Tn.Mean<-th1[1]*D1[1,1]       # Truncated normal mean,sd,lower and upper limits\n  Stage1.S1.O1.Tn.Sd<-sqrt(D1[1,1])\n  Stage1.S1.O1.Tn.Lower<-a*sqrt(D1[1,1])\n  Stage1.S1.O1.Tn.Upper<-b*sqrt(D1[1,1])     # upper limit to see if the outcome cross the upper boundary for efficacy\n\n\n  Stage2.S1.O1.Nor.Mean<-th1[1]*(D2[1,1])     # When the trial continues in the second stage, this information is needed\n  Stage2.S1.O1.Nor.Sd<-sqrt((D2[1,1]))        # for the second stage distribition of outcome 1\n  Stage2.S1.O1.Nor.Lower<-c1*sqrt(D1[1,1]+D2[1,1])\n\n\n\n  Stage2.S1.O1.Int<-function(u)\n\n  {\n\n    return(dtnorm(u,Stage1.S1.O1.Tn.Mean,Stage1.S1.O1.Tn.Sd,lower=Stage1.S1.O1.Tn.Lower)*\n             pnorm(Stage2.S1.O1.Nor.Lower,Stage2.S1.O1.Nor.Mean+u,Stage2.S1.O1.Nor.Sd,lower.tail=lt))\n\n  }\n\n\n  int.u<-integrate(Vectorize(Stage2.S1.O1.Int),lower=l.lim,upper=u.lim)\n\n\n  return(int.u$value)\n\n}\n\n\n\n##\n##Stage2.S2.O1.Dt(a=-0.1040146,b=2.2773003,c1=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),l.lim=1,u.lim=Inf,lt=F)\n##\n\n\n##########################################################\n# Function 48. Stage 2 subgroup 1 outcome 2 distribution\n# lt=F will generate the proability that the outcome 2 in stage 2 is above efficacy boundary\n#lt=T will generate the proability that the outcome 2 in stage 2 is below efficacy boundary\n# l.lim and u.lim will regulate if the outcome 2 at stage 1 was above/below efficacy boundary\n##########################################################\n##########################################################\n\n\nStage2.S1.O2.Dt<-function(a,b,c2,th1,th2,D,Ds2,l.lim,u.lim,lt)\n\n{\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S1.O2.Tn.Mean<-th1[2]*D1[1,2]       # Truncated normal mean,sd,lower and upper limits\n  Stage1.S1.O2.Tn.Sd<-sqrt(D1[1,2])\n  Stage1.S1.O2.Tn.Lower<-a*sqrt(D1[1,2])\n  Stage1.S1.O2.Tn.Upper<-b*sqrt(D1[1,2])     # upper limit to see if the outcome cross the upper boundary for efficacy\n\n\n  Stage2.S1.O2.Nor.Mean<-th1[2]*(D2[1,2])     # When the trial continues in the second stage, this information is needed\n  Stage2.S1.O2.Nor.Sd<-sqrt((D2[1,2]))        # for the second stage distribition of outcome 1\n  Stage2.S1.O2.Nor.Lower<-c2*sqrt(D1[1,2]+D2[1,2])\n\n\n\n  Stage2.S1.O2.Int<-function(v)\n\n  {\n\n    return(dtnorm(v,Stage1.S1.O2.Tn.Mean,Stage1.S1.O2.Tn.Sd,lower=Stage1.S1.O2.Tn.Lower)*\n             pnorm(Stage2.S1.O2.Nor.Lower,Stage2.S1.O2.Nor.Mean+v,Stage2.S1.O2.Nor.Sd,lower.tail=lt))\n\n  }\n\n\n  int.v<-integrate(Vectorize(Stage2.S1.O2.Int),lower=l.lim,upper=u.lim)\n\n\n  return(int.v$value)\n\n}\n\n\n#Stage2.S2.O2.Dt(a=-0.1040146,b=2.2773003,c2=1,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),l.lim=1,u.lim=Inf,lt=F)\n\n\n##########################################################\n# Function 49. Stage 2 subgroup 1 distribution\n# lt=F will give the rejection probability for subgroup 1 in stage 2\n##########################################################\n\n\n\nStage2.S1.Reject.Given.S1.Select<-function(a,b,c1,c2,th1,th2,D,Ds2){\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n  Stage1.S1.O1.Tn.Lower<-a*sqrt(D1[1,1])\n  Stage1.S1.O1.Tn.Upper<-b*sqrt(D1[1,1])\n  Stage1.S1.O2.Tn.Lower<-a*sqrt(D1[1,2])\n  Stage1.S1.O2.Tn.Upper<-b*sqrt(D1[1,2])\n\n\n  ((Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Upper,u.lim=Inf,lt=F)*\n      Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=F))+\n\n      (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=F)*\n         Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Upper,u.lim=Inf,lt=F))+\n\n      (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=F)*\n         Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=F)))\n\n}\n\n\n\n\n#Stage2.S1.Reject.Given.S1.Select(a=-0.1040146,b=2.2773003,c1=1,c2=1,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n\n\n\n###########################################################\n# Subgroup 1 efficacy in stage 2\n#\n###########################################################\n\nStage2.S1.Ef<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage1.S1.Select(a,b,th1,th2,D)*Stage2.S1.Reject.Given.S1.Select(a,b,c1,c2,th1,th2,D,Ds2)\n\n}\n\n\n##\n## Stage2.S1.Ef(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n\n\n\n###########################################################\n# Stage 2 stop for futility in Subgroup 1, given subgroup 1 selected\n#\n###########################################################\n\n\n\nStage2.S1.Accept.Given.S1.Select<-function(a,b,c1,c2,th1,th2,D,Ds2){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S1.O1.Tn.Lower<-a*sqrt(D1[1,1])\n  Stage1.S1.O1.Tn.Upper<-b*sqrt(D1[1,1])\n  Stage1.S1.O2.Tn.Lower<-a*sqrt(D1[1,2])\n  Stage1.S1.O2.Tn.Upper<-b*sqrt(D1[1,2])\n\n\n  (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Upper,u.lim=Inf,lt=F)*\n      Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=T))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Upper,u.lim=Inf,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=F))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Upper,u.lim=Inf,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=T))+\n\n\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=F)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Upper,u.lim=Inf,lt=T))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Upper,u.lim=Inf,lt=F))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Upper,u.lim=Inf,lt=T))+\n\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=F)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=T))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=F))+\n    (Stage2.S1.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O1.Tn.Lower,u.lim=Stage1.S1.O1.Tn.Upper,lt=T)*\n       Stage2.S1.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S1.O2.Tn.Lower,u.lim=Stage1.S1.O2.Tn.Upper,lt=T))\n}\n\n\n\n##\n##Stage2.S1.Accept.Given.S1.Select(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n###########################################################\n# Subgroup 1 futility in stage 2\n#\n###########################################################\n\nStage2.S1.Ft<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage1.S1.Select(a,b,th1,th2,D)*Stage2.S1.Accept.Given.S1.Select(a,b,c1,c2,th1,th2,D,Ds2)\n\n}\n\n\n#Stage2.S1.Ft(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n\n\n\n\n\n##########################################################\n# Function 50. Stage 2 subgroup 2 outcome 1 distribution\n#lt=F will generate the proability that the outcome 1 in stage 2 is above efficacy boundary\n#lt=T will generate the proability that the outcome 1 in stage 2 is below efficacy boundary\n# l.lim and u.lim will regulate if the outcome 1 at stage 1 was above/below efficacy boundary\n\n##########################################################\n\n\nStage2.S2.O1.Dt<-function(a,b,c1,th1,th2,D,Ds2,l.lim,u.lim,lt)\n\n{\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S2.O1.Tn.Mean<-th2[1]*D1[2,1]       # Truncated normal mean,sd,lower and upper limits\n  Stage1.S2.O1.Tn.Sd<-sqrt(D1[2,1])\n  Stage1.S2.O1.Tn.Lower<-a*sqrt(D1[2,1])\n  Stage1.S2.O1.Tn.Upper<-b*sqrt(D1[2,1])     # upper limit to see if the outcome cross the upper boundary for efficacy\n\n\n  Stage2.S2.O1.Nor.Mean<-th2[1]*(D2[2,1])     # When the trial continues in the second stage, this information is needed\n  Stage2.S2.O1.Nor.Sd<-sqrt((D2[2,1]))        # for the second stage distribition of outcome 1\n  Stage2.S2.O1.Nor.Lower<-c1*sqrt(D1[2,1]+D2[2,1])\n\n\n\n  Stage2.S2.O1.Int<-function(u)\n\n  {\n\n    return(dtnorm(u,Stage1.S2.O1.Tn.Mean,Stage1.S2.O1.Tn.Sd,lower=Stage1.S2.O1.Tn.Lower)*\n             pnorm(Stage2.S2.O1.Nor.Lower,Stage2.S2.O1.Nor.Mean+u,Stage2.S2.O1.Nor.Sd,lower.tail=lt))\n\n  }\n\n\n  int.u<-integrate(Vectorize(Stage2.S2.O1.Int),lower=l.lim,upper=u.lim)\n\n\n  return(int.u$value)\n\n}\n\n\n\n\n\n\n\n##########################################################\n# Function 51. Stage 2 subgroup 2 outcome 2 distribution\n# lt=F will generate the proability that the outcome 2 in stage 2 is above efficacy boundary\n# lt=T will generate the proability that the outcome 2 in stage 2 is below efficacy boundary\n# l.lim and u.lim will regulate if the outcome 2 at stage 1 was above/below efficacy boundary\n\n##########################################################\n\n\nStage2.S2.O2.Dt<-function(a,b,c2,th1,th2,D,Ds2,l.lim,u.lim,lt)\n\n{\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S2.O2.Tn.Mean<-th2[2]*D1[2,2]       # Truncated normal mean,sd,lower and upper limits\n  Stage1.S2.O2.Tn.Sd<-sqrt(D1[2,2])\n  Stage1.S2.O2.Tn.Lower<-a*sqrt(D1[2,2])\n  Stage1.S2.O2.Tn.Upper<-b*sqrt(D1[2,2])     # upper limit to see if the outcome cross the upper boundary for efficacy\n\n\n  Stage2.S2.O2.Nor.Mean<-th2[2]*(D2[2,2])     # When the trial continues in the second stage, this information is needed\n  Stage2.S2.O2.Nor.Sd<-sqrt((D2[2,2]))        # for the second stage distribition of outcome 1\n  Stage2.S2.O2.Nor.Lower<-c2*sqrt(D1[2,2]+D2[2,2])\n\n\n\n  Stage2.S2.O2.Int<-function(v)\n\n  {\n\n    return(dtnorm(v,Stage1.S2.O2.Tn.Mean,Stage1.S2.O2.Tn.Sd,lower=Stage1.S2.O2.Tn.Lower)*\n             pnorm(Stage2.S2.O2.Nor.Lower,Stage2.S2.O2.Nor.Mean+v,Stage2.S2.O2.Nor.Sd,lower.tail=lt))\n\n  }\n\n\n  int.v<-integrate(Vectorize(Stage2.S2.O2.Int),lower=l.lim,upper=u.lim)\n\n\n  return(int.v$value)\n\n}\n\n\n\n##########################################################\n# Function 52. Stage 2 subgroup 2 distribution\n# lt=F will give the rejection probability for subgroup 2 in stage 2\n# lt=T will give the probability that the outcome 2 at stage 2 is below the efficacy boundary\n##########################################################\n\n\n\nStage2.S2.Reject.Given.S2.Select<-function(a,b,c1,c2,th1,th2,D,Ds2){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S2.O1.Tn.Lower<-a*sqrt(D1[2,1])\n  Stage1.S2.O1.Tn.Upper<-b*sqrt(D1[2,1])\n  Stage1.S2.O2.Tn.Lower<-a*sqrt(D1[2,2])\n  Stage1.S2.O2.Tn.Upper<-b*sqrt(D1[2,2])\n\n\n  ((Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Upper,u.lim=Inf,lt=F)*\n      Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=F))+\n\n      (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=F)*\n         Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Upper,u.lim=Inf,lt=F))+\n\n      (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=F)*\n         Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=F)))\n\n\n}\n\n\n\n#Stage2.S2.Reject.Given.S2.Select(a=-0.1040146,b=2.2773003,c1=1,c2=1,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n\n\n###########################################################\n# Subgroup 2 efficacy in stage 2\n#\n###########################################################\n\nStage2.S2.Ef<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage1.S2.Select(a,b,th1,th2,D)*Stage2.S2.Reject.Given.S2.Select(a,b,c1,c2,th1,th2,D,Ds2)\n\n}\n\n\n##\n##Stage2.S2.Ef(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n###########################################################\n# Subgroup 2 stop for futility in stage 2 given subgroup 2 selected\n#\n###########################################################\n\n\n\nStage2.S2.Accept.Given.S2.Select<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n  Stage1.S2.O1.Tn.Lower<-a*sqrt(D1[2,1])\n  Stage1.S2.O1.Tn.Upper<-b*sqrt(D1[2,1])\n  Stage1.S2.O2.Tn.Lower<-a*sqrt(D1[2,2])\n  Stage1.S2.O2.Tn.Upper<-b*sqrt(D1[2,2])\n\n  (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Upper,u.lim=Inf,lt=F)*\n      Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=T))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Upper,u.lim=Inf,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=F))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Upper,u.lim=Inf,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=T))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=F)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Upper,u.lim=Inf,lt=T))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Upper,u.lim=Inf,lt=F))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Upper,u.lim=Inf,lt=T))+\n\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=F)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=T))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=F))+\n    (Stage2.S2.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O1.Tn.Lower,u.lim=Stage1.S2.O1.Tn.Upper,lt=T)*\n       Stage2.S2.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S2.O2.Tn.Lower,u.lim=Stage1.S2.O2.Tn.Upper,lt=T))\n\n\n}\n\n#Stage2.S2.Accept.Given.S2.Select(a=-0.1040146,b=2.2773003,c1=1,c2=1,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n\n\n\n\n###########################################################\n# Subgroup 2 efficacy in stage 2\n#\n###########################################################\n\nStage2.S2.Ft<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage1.S2.Select(a,b,th1,th2,D)*Stage2.S2.Accept.Given.S2.Select(a,b,c1,c2,th1,th2,D,Ds2)\n\n}\n\n##\n##Stage2.S2.Ft(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n\n\n##########################################################\n# Function 53. Stage 2 subgroup 1 & 2, Outcome 1 distribution\n# lt=F will give the rejection probability for subgroup 2\n##########################################################\n\n\nStage2.S12.O1.Dt<-function(a,b,c1,th1,th2,D,Ds2,l.lim,u.lim,lt){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  mu11=th1[1]*D1[1,1]\n  sig11=sqrt(D1[1,1])\n  mu21=th2[1]*D1[2,1]\n  sig21=sqrt(D1[2,1])\n\n  Stage1.S1.O1.Select.lower=a*sqrt(D1[1,1])\n  Stage1.S2.O1.Select.lower=a*sqrt(D1[2,1])\n\n  Stage1.S12.O1.Tn.upper=b*sqrt(D1[1,1]+D1[2,1])\n\n\n  muS1=((th1[1]*D2[1,1]+th2[1]*D2[2,1])/(D2[1,1]+D2[2,1]))*(D2[1,1]+D2[2,1]) #need to discuss this computation\n  sigS1=sqrt(D2[1,1]+D2[2,1])\n  Stage2.S12.O1.lower=c1*sqrt(D1[1,1]+D1[2,1]+D2[1,1]+D2[2,1])\n\n\n  Stage2.S12.O1.Int<-function(y)\n  {\n\n\n    Stage1.S12.O1.Tn.Dt <- function(y)\n    {\n\n      integrand <- function(x)\n      {\n\n        f1 <- dtnorm(x,mu11,sig11,lower=Stage1.S1.O1.Select.lower)\n        f2 <- dtnorm(y-x,mu21,sig21,lower=Stage1.S2.O1.Select.lower)\n        return(f1*f2)\n      }\n\n      int.x <- integrate(integrand,lower=Stage1.S1.O1.Select.lower,upper=y-Stage1.S2.O1.Select.lower)\n\n      return(int.x$value)\n    }\n\n\n    return(Stage1.S12.O1.Tn.Dt(y)*pnorm(Stage2.S12.O1.lower,muS1+y,sigS1,lower.tail=lt))\n\n    #lt=F will return the probability that the outcome 1 is above the efficacy boundary\n    #lt=T will return the probability that the outcome 1 is below the efficacy boundary\n\n  }\n\n  int.w<-integrate(Vectorize(Stage2.S12.O1.Int),lower=l.lim,upper=u.lim)\n  # l.lim and u.lim will regulate if the outcome is above/below the efficacy boundary in stage 1\n\n  return(int.w$value)\n}\n\n\n\n#Stage2.S12.O1.Dt(a=-0.1040146,b=2.2773003,c1=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),l.lim=-Inf,u.lim=b*sqrt(D1[1,1]+D1[2,1]),lt=F)\n\n\n\n##########################################################\n# Function 54. Stage 2 subgroup 1 & 2, Outcome 2 distribution\n# lt=F will give the rejection probability for subgroup 2\n##########################################################\n\n\n\nStage2.S12.O2.Dt<-function(a,b,c2,th1,th2,D,Ds2,l.lim,u.lim,lt){\n\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  mu12=th1[2]*D1[1,2]\n  sig12=sqrt(D1[1,2])\n  mu22=th2[2]*D1[2,2]\n  sig22=sqrt(D1[2,2])\n\n\n  Stage1.S1.O2.Select.lower=a*sqrt(D1[1,2])\n  Stage1.S2.O2.Select.lower=a*sqrt(D1[2,2])\n\n  Stage1.S12.O2.Tn.Upper=b*sqrt(D1[1,2]+D1[2,2])\n\n  muS2=((th1[2]*D2[1,2]+th2[2]*D2[2,2])/(D2[1,2]+D2[2,2]))*(D2[1,2]+D2[2,2])\n  sigS2=sqrt(D2[1,2]+D2[2,2])\n  Stage2.S12.O2.lower=c2*sqrt(D1[1,2]+D1[2,2]+D2[1,2]+D2[2,2])\n\n\n  Stage2.S12.O2.Int<-function(y)\n  {\n\n\n    Stage1.S12.O2.Tn.Dt <- function(y)\n    {\n\n      integrand <- function(x)\n      {\n\n        f1 <- dtnorm(x,mu12,sig12,lower=Stage1.S1.O2.Select.lower)\n        f2 <- dtnorm(y-x,mu22,sig22,lower=Stage1.S2.O2.Select.lower)\n        return(f1*f2)\n      }\n\n      int.x <- integrate(integrand,lower=Stage1.S1.O2.Select.lower,upper=y-Stage1.S2.O2.Select.lower)\n\n      return(int.x$value)\n    }\n\n\n    return(Stage1.S12.O2.Tn.Dt(y)*pnorm(Stage2.S12.O2.lower,muS2+y,sigS2,lower.tail=lt))\n\n    #lt=F will return the probability that the outcome 2 is above the efficacy boundary\n    #lt=T will return the probability that the outcome 2 is below the efficacy boundary\n\n\n  }\n\n  int.w<-integrate(Vectorize(Stage2.S12.O2.Int),lower=l.lim,upper=u.lim)\n\n  # l.lim and u.lim will regulate if the outcome is above/below the efficacy boundary in stage 1\n\n\n  return(int.w$value)\n}\n\n\n##\n##Stage2.S12.O2.Dt(a=-0.1040146,b=2.2773003,c=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),l.lim=-Inf,u.lim=b*sqrt(D1[1,1]+D1[2,1]),lt=F)\n##\n\n\n\n\n##########################################################\n# Function 55. Stage 2 subgroup 1 & 2 distribution\n# lt=F will give the rejection probability for subgroup 1 and 2\n##########################################################\n\n\n\nStage2.S12.Reject.Given.S12.Select<-function(a,b,c1,c2,th1,th2,D,Ds2){\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S12.O1.Tn.Upper=b*sqrt(D1[1,1]+D1[2,1])\n  Stage1.S12.O2.Tn.Upper=b*sqrt(D1[1,2]+D1[2,2])\n\n\n  ((Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=F)*\n      Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O2.Tn.Upper,u.lim=Inf,lt=F))+\n\n      (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O1.Tn.Upper,u.lim=Inf,lt=F)*\n         Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=F))+\n\n      (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=F)*\n         Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=F)))\n\n\n}\n\n##\n##Stage2.S12.Reject.Given.S12.Select(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n\n\n\n\n\n\n\nStage2.S12.Ef<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n\n  Prob.E15(a,th1,th2,D)*Stage2.S12.Reject.Given.S12.Select(a,b,c1,c2,th1,th2,D,Ds2)\n}\n\n##\n##Stage2.S12.Ef(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n# Will work from here. C1 in c1=c2 needed to be changed to c2=c2.\n# lower limit should be changed to -Inf\n# upper limits should be added in the function\n\nStage2.S12.Accept.Given.S12.Select<-function(a,b,c1,c2,th1,th2,D,Ds2){\n  D1=matrix(D,nrow=2,ncol=2,byrow=T)\n  D2=matrix(Ds2,nrow=2,ncol=2,byrow=T)\n\n\n  Stage1.S12.O1.Tn.Upper=b*sqrt(D1[1,1]+D1[2,1])\n  Stage1.S12.O2.Tn.Upper=b*sqrt(D1[1,2]+D1[2,2])\n\n\n\n  ((Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O1.Tn.Upper,u.lim=Inf,lt=F)*\n      Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=T))+\n\n      (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O1.Tn.Upper,u.lim=Inf,lt=T)*\n         Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=F))+\n\n      (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O1.Tn.Upper,u.lim=Inf,lt=T)*\n         Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=T)))+\n\n    ((Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=F)*\n        Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O2.Tn.Upper,u.lim=Inf,lt=T))+\n\n       (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=T)*\n          Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O2.Tn.Upper,u.lim=Inf,lt=F))+\n\n       (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=T)*\n          Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=Stage1.S12.O2.Tn.Upper,u.lim=Inf,lt=T)))+\n\n\n    ((Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=F)*\n        Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=T))+\n\n       (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=T)*\n          Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=F))+\n\n       (Stage2.S12.O1.Dt(a=a,b=b,c1=c1,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O1.Tn.Upper,lt=T)*\n          Stage2.S12.O2.Dt(a=a,b=b,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2,l.lim=-Inf,u.lim=Stage1.S12.O2.Tn.Upper,lt=T)))\n\n\n}\n\n##\n##Stage2.S12.Accept.Given.S12.Select(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n\n\n\n\nStage2.S12.Ft<-function(a,b,c1,c2,th1,th2,D,Ds2){\n\n  Prob.E15(a,th1,th2,D)*Stage2.S12.Accept.Given.S12.Select(a,b,c1,c2,th1,th2,D,Ds2)\n\n}\n\n\n##\n##Stage2.S12.Ft(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n##########################################################\n# Function 44. Stage 2 total rejection probability for efficacy\n#\n##########################################################\n\n\nStage2.Total.Ef<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage2.S1.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)+\n    Stage2.S2.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)+\n    Stage2.S12.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)\n}\n\n##\n##Stage2.Total.Ef(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n##########################################################\n# Function 44. Stage 2 total rejection probability for futility\n#\n##########################################################\n\n\nStage2.Total.Ft<-function(a,b,c1,c2,th1,th2,D,Ds2)\n\n{\n  Stage2.S1.Ft(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)+\n    Stage2.S2.Ft(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)+\n    Stage2.S12.Ft(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)\n}\n\n\n##\n##Stage2.Total.Ft(a=-0.1040146,b=2.2773003,c1=2,c2=2,th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1))\n##\n\n\n\n##########################################################\n# Function 45. Computation of boundary values in Stage II\n#\n##########################################################\n\n\nStage2.Boundary.Values<-function(lims2,lims1,th1,th2,D,Ds2,au2,al2,optimize=T){\n\n  a=lims1[1]\n  b=lims1[2]\n  c1=lims2[1]\n  c2=lims2[2]\n\n  if (optimize==T) {\n\n    retval<-(Stage2.Total.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)-au2)^2+\n      (Stage2.Total.Ft(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)-al2)^2+\n      (lims2[2]-lims2[1])^2\n\n  } else{\n\n    retval<-list(TR=Stage2.Total.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 OR=Stage2.S12.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 S1=Stage2.S1.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 S2=Stage2.S2.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2))\n\n  }\n  return(retval)\n\n}\n\n\n\n##\n##optim(c(2,2),Stage2.Boundary.Values,lims1=c(-0.1040146,2.2773003),th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),au2=0.0003125,al2=0.4996875,optimize=T,method=\"Nelder-Mead\",control=list(maxit=1000))\n##\n\n\n#Stage2.Boundary.Values(lims2=c(1.7,1.7),lims1=c(-0.1040146,2.2773003),th1=c(0,0),th2=c(0,0),D=c(1,1,1,1),Ds2=c(1,1,1,1),au2=0.0003125,al2=0.4996875,optimize=F)\n\n\n##########################################################\n# Function 46. Computation of Optimum information in Stage I\n#\n##########################################################\n\n\nStage2.Inf.Optimization<-function(Ds2,lims2,lims1,th1,th2,D,optimize=T)\n\n{\n  a=lims1[1]\n  b=lims1[2]\n  c1=lims2[1]\n  c2=lims2[2]\n\n  if (optimize==T) {\n\n    retval<-(Stage2.Total.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2)-0.405)^2\n\n\n  } else{\n\n    retval<-list(TR=Stage2.Total.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 OR=Stage2.S12.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 S1=Stage2.S1.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2),\n                 S2=Stage2.S2.Ef(a=a,b=b,c1=c1,c2=c2,th1=th1,th2=th2,D=D,Ds2=Ds2))\n\n  }\n\n  return(retval)\n\n}\n",
    "created" : 1552193647762.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3511286243",
    "id" : "764FE7DE",
    "lastKnownWriteTime" : 1552194747,
    "last_content_update" : 1552194747831,
    "path" : "Z:/My documents/1packages/agseDesign/R/internal.R",
    "project_path" : "R/internal.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}